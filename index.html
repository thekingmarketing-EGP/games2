<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>كشري الوزير</title>
<style>
    :root { --primary: #e67e22; --danger: #c0392b; --accent: #f1c40f; }
    
    * { touch-action: manipulation; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body { margin:0; overflow:hidden; background:#1a1a1a; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
    
    #game { 
        position:relative; width:400px; height:600px; 
        background-image: url('اختراق.jpg'); background-size: contain; /* تعديل لظهور الصورة كاملة */
        background-repeat: no-repeat; background-position: center;
        background-color: #000;
        overflow:hidden; border:5px solid #e67e22; border-radius: 15px;
        max-width: 100vw; max-height: 100vh;
    }

    #ui { 
        position:absolute; top:0; left:0; width:100%; padding: 10px; box-sizing: border-box;
        display: flex; justify-content: space-between; background: rgba(0, 0, 0, 0.6); z-index: 10;
    }
    .stat-value { font-size: 18px; font-weight: 900; color: #f1c40f; }

    .player { 
        position:absolute; width: 70px; height: 50px; 
        background-image: url('الطبق.png'); background-size: contain;
        background-repeat: no-repeat; background-position: center;
        z-index: 5;
    }

    .platform { 
        position:absolute; width:100px; height:12px; 
        background: #fff; border-radius:10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); 
    }
    .platform.moving { background: var(--accent); }
    .platform.breakable { background: var(--danger); }

    #controls {
        position: absolute; bottom: 20px; left: 0; width: 100%;
        display: none; justify-content: space-around; z-index: 20;
    }
    .touch-btn {
        width: 65px; height: 65px; background: rgba(230, 126, 34, 0.4);
        border-radius: 50%; display: flex; justify-content: center; align-items: center;
        color: white; font-size: 25px; border: 2px solid #fff;
    }

    .overlay { 
        position:absolute; inset:0; 
        display:flex; flex-direction:column; justify-content:center; align-items:center; 
        color:#fff; z-index: 100; text-align: center; padding: 20px;
    }
    
    #startScreen {
        background-image: url('U.jpg'); 
        background-size: contain; /* تعديل لظهور صورة البداية كاملة */
        background-repeat: no-repeat;
        background-position: center;
        background-color: #000;
    }
    /* طبقة شفافة خفيفة لقراءة النص */
    #startScreen::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.4); }
    #startScreen * { z-index: 2; }

    #gameOverScreen { background: rgba(0,0,0,0.85); display: none; }

    .btn { 
        padding: 12px 30px; font-size: 20px; cursor: pointer; 
        background: var(--primary); border: 3px solid #fff; color: white; 
        border-radius: 50px; font-weight: bold; text-shadow: 1px 1px 2px #000;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    @media (max-width: 500px) {
        #game { width: 100vw; height: 100vh; border: none; border-radius: 0; }
        #controls { display: flex; }
    }
</style>
</head>
<body>

<div id="game">
    <div id="ui">
        <div class="stat-box">الطلب: <span id="scoreVal" class="stat-value">0</span></div>
        <div class="stat-box">سرعة التحضير: <span id="speedVal" class="stat-value">1.0x</span></div>
    </div>

    <div id="player" class="player"></div>

    <div id="controls">
        <div class="touch-btn" id="btnLeft">◀</div>
        <div class="touch-btn" id="btnJump">نط</div>
        <div class="touch-btn" id="btnRight">▶</div>
    </div>

    <div id="startScreen" class="overlay">
        <h1 style="color:var(--accent); font-size: 40px; margin-bottom:10px;">كشري الوزير</h1>
        <p style="font-size: 18px; margin-bottom:30px;">أجدع طبق كشري في مصر!</p>
        <button id="startBtn" class="btn">اطلب الأوردر (ابدأ)</button>
    </div>

    <div id="gameOverScreen" class="overlay">
        <h1 style="color:var(--danger); font-size: 35px;">الصلصة شاطت!</h1>
        <p style="font-size: 20px;">حسابك عمل: <span id="finalScore" style="color:var(--accent)">0</span> جنية</p>
        <p>الزبون مشي والطبق وقع..</p>
        <button id="restartBtn" class="btn">نزل طبق جديد</button>
    </div>
</div>

<script>
const game = document.getElementById('game');
const playerEl = document.getElementById('player');
const scoreVal = document.getElementById('scoreVal');
const speedVal = document.getElementById('speedVal');

let config = {
    gravity: 0.7,
    jumpForce: -16,
    moveSpeed: 1.5,
    friction: 0.85,
    baseScrollSpeed: 1.8,
    difficultyScale: 0.0008 
};

let state = {
    x: 160, y: 350,
    vx: 0, vy: 0,
    score: 0,
    gameActive: false,
    scrollSpeed: config.baseScrollSpeed,
    platforms: []
};

function initPlatforms() {
    state.platforms = [];
    game.querySelectorAll('.platform').forEach(p => p.remove());
    createPlatform(50, 520, 300, 'normal'); 
    for(let i = 1; i < 7; i++) {
        spawnPlatform(520 - (i * 105));
    }
}

function spawnPlatform(yPos) {
    let type = 'normal';
    if (state.score >= 500) {
        let rand = Math.random();
        if (rand > 0.7) type = 'moving';
        else if (rand > 0.4) type = 'breakable';
    }
    createPlatform(Math.random() * (game.clientWidth - 110), yPos, 110, type);
}

function createPlatform(x, y, width, type) {
    const el = document.createElement('div');
    el.className = 'platform ' + type;
    el.style.width = width + 'px';
    game.appendChild(el);
    state.platforms.push({ el, x, y, w: width, h: 12, type, dir: Math.random() > 0.5 ? 1 : -1, broken: false });
}

let keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

const touchControls = {
    'btnLeft': 'ArrowLeft',
    'btnRight': 'ArrowRight',
    'btnJump': 'ArrowUp'
};

Object.keys(touchControls).forEach(id => {
    const btn = document.getElementById(id);
    const keyCode = touchControls[id];
    btn.ontouchstart = (e) => { e.preventDefault(); keys[keyCode] = true; };
    btn.ontouchend = (e) => { e.preventDefault(); keys[keyCode] = false; };
});

document.getElementById('startBtn').onclick = startGame;
document.getElementById('restartBtn').onclick = () => location.reload();

function startGame() {
    document.getElementById('startScreen').style.display = 'none';
    state.gameActive = true;
    initPlatforms();
    requestAnimationFrame(loop);
}

function loop() {
    if (!state.gameActive) return;

    if (keys['ArrowLeft']) state.vx -= config.moveSpeed;
    if (keys['ArrowRight']) state.vx += config.moveSpeed;
    state.vx *= config.friction;
    state.x += state.vx;

    state.vy += config.gravity;
    state.y += state.vy;
    state.y += state.scrollSpeed;
    state.scrollSpeed += config.difficultyScale;
    speedVal.innerText = (state.scrollSpeed / config.baseScrollSpeed).toFixed(1) + "x";

    state.platforms.forEach(p => {
        p.y += state.scrollSpeed;
        if (p.type === 'moving') {
            p.x += p.dir * (2 + state.score/1000);
            if (p.x <= 0 || p.x + p.w >= game.clientWidth) p.dir *= -1;
        }

        if (!p.broken && state.vy >= 0 && 
            state.x + 50 > p.x && state.x + 20 < p.x + p.w && 
            state.y + 45 >= p.y && state.y + 45 <= p.y + 20) {
            
            state.y = p.y - 50;
            state.vy = 0;
            if (p.type === 'moving') state.x += p.dir * (2 + state.score/1000);

            if (keys['ArrowUp'] || keys['Space']) {
                state.vy = config.jumpForce;
                if (p.type === 'breakable') { p.broken = true; p.el.style.opacity = '0.3'; }
            }
        }
        p.el.style.left = p.x + 'px';
        p.el.style.top = p.y + 'px';
    });

    for (let i = state.platforms.length - 1; i >= 0; i--) {
        if (state.platforms[i].y > 600) {
            state.platforms[i].el.remove();
            state.platforms.splice(i, 1);
            spawnPlatform(-20);
            state.score += 10;
            scoreVal.innerText = state.score;
        }
    }

    if (state.x < -20) state.x = -20;
    if (state.x > game.clientWidth - 50) state.x = game.clientWidth - 50;

    playerEl.style.left = state.x + 'px';
    playerEl.style.top = state.y + 'px';

    if (state.y > 600 || state.y < -150) {
        state.gameActive = false;
        document.getElementById('gameOverScreen').style.display = 'flex';
        document.getElementById('finalScore').innerText = state.score;
    } else {
        requestAnimationFrame(loop);
    }
}
</script>
</body>
</html>