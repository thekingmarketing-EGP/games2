<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>كشري الوزير</title>
<style>
    :root { --primary: #ff6b12; --danger: #ff4757; --accent: #f1c40f; }
    
    * { touch-action: manipulation; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body { margin:0; overflow:hidden; background:#111; font-family: 'Arial', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
    
    #game { 
        position:relative; width:400px; height:600px; 
        background-image: url('اختراق.jpg'); background-size: contain; 
        background-repeat: no-repeat; background-position: center;
        background-color: #000;
        overflow:hidden; border:4px solid var(--primary); border-radius: 15px;
        max-width: 100vw; max-height: 100vh;
    }

    #ui { 
        position:absolute; top:0; left:0; width:100%; padding: 12px; box-sizing: border-box;
        display: flex; justify-content: space-between; background: rgba(0, 0, 0, 0.8); z-index: 50;
    }
    .stat-value { font-size: 18px; font-weight: bold; color: var(--accent); }

    .player { 
        position:absolute; width: 70px; height: 50px; 
        background-image: url('الطبق.png'); background-size: contain;
        background-repeat: no-repeat; background-position: center;
        z-index: 5;
    }

    .platform { 
        position:absolute; width:100px; height:12px; 
        background: #eee; border-radius:10px; box-shadow: 0 4px 6px rgba(0,0,0,0.4); 
    }

    /* أزرار التحكم - جعلتها أوضح بكثير */
    #controls {
        position: absolute; bottom: 30px; left: 0; width: 100%;
        display: flex; justify-content: space-evenly; z-index: 100;
    }
    .touch-btn {
        width: 80px; height: 80px; background: rgba(255, 107, 18, 0.9); /* برتقالي غامق واضح */
        border-radius: 15px; display: flex; justify-content: center; align-items: center;
        color: white; font-size: 35px; border: 3px solid #fff;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .touch-btn:active { background: #fff; color: var(--primary); }

    .overlay { 
        position:absolute; inset:0; 
        display:flex; flex-direction:column; justify-content:center; align-items:center; 
        color:#fff; z-index: 200; text-align: center; padding: 20px;
    }
    
    #startScreen {
        background-image: url('U.jpg'); background-size: contain;
        background-repeat: no-repeat; background-position: center;
        background-color: #000;
    }
    #startScreen::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.5); }
    #startScreen * { z-index: 2; }

    #gameOverScreen { background: rgba(0,0,0,0.9); display: none; }

    .btn { 
        padding: 15px 40px; font-size: 24px; cursor: pointer; 
        background: var(--primary); border: none; color: white; 
        border-radius: 10px; font-weight: bold;
        box-shadow: 0 4px 0 #a3450b;
    }
    .btn:active { transform: translateY(4px); box-shadow: none; }

    @media (max-width: 500px) {
        #game { width: 100vw; height: 100vh; border: none; border-radius: 0; }
    }
</style>
</head>
<body>

<div id="game">
    <div id="ui">
        <div>الطلب: <span id="scoreVal" class="stat-value">0</span></div>
        <div>النار: <span id="speedVal" class="stat-value">هادية</span></div>
    </div>

    <div id="player" class="player"></div>

    <div id="controls">
        <div class="touch-btn" id="btnLeft">◀</div>
        <div class="touch-btn" id="btnJump">نط</div>
        <div class="touch-btn" id="btnRight">▶</div>
    </div>

    <div id="startScreen" class="overlay">
        <h1 style="color:var(--accent); font-size: 45px; margin-bottom:5px;">كشري الوزير</h1>
        <p style="margin-bottom:30px; font-size: 20px;">جاهز تغرف أحلى طبق؟</p>
        <button id="startBtn" class="btn">افتح المحل (ابدأ)</button>
    </div>

    <div id="gameOverScreen" class="overlay">
        <h1 style="color:var(--danger); font-size: 40px;">القدرة خلصت!</h1>
        <p style="font-size: 22px;">جمعت حساب: <span id="finalScore" style="color:var(--accent)">0</span> جنية</p>
        <button id="restartBtn" class="btn">شغل البوتجاز تاني</button>
    </div>
</div>

<script>
const game = document.getElementById('game');
const playerEl = document.getElementById('player');
const scoreVal = document.getElementById('scoreVal');
const speedVal = document.getElementById('speedVal');

// تم تقليل القيم هنا لجعل اللعبة أبطأ وأسهل
let config = {
    gravity: 0.5,        // كانت 0.7 (أخف شوية)
    jumpForce: -13,      // كانت -16 (قفزة أهدى)
    moveSpeed: 1.2,      // كانت 1.5 (تحكم أدق)
    friction: 0.85,
    baseScrollSpeed: 1.2,// كانت 1.8 (الكاميرا أبطأ)
    difficultyScale: 0.0004 // كانت 0.0008 (الصعوبة بتزيد ببطء)
};

let state = {
    x: 160, y: 350,
    vx: 0, vy: 0,
    score: 0,
    gameActive: false,
    scrollSpeed: config.baseScrollSpeed,
    platforms: []
};

function initPlatforms() {
    state.platforms = [];
    game.querySelectorAll('.platform').forEach(p => p.remove());
    createPlatform(50, 520, 300, 'normal'); 
    for(let i = 1; i < 7; i++) {
        spawnPlatform(520 - (i * 105));
    }
}

function spawnPlatform(yPos) {
    let type = 'normal';
    if (state.score >= 400) {
        let rand = Math.random();
        if (rand > 0.8) type = 'moving';
        else if (rand > 0.6) type = 'breakable';
    }
    createPlatform(Math.random() * (game.clientWidth - 110), yPos, 110, type);
}

function createPlatform(x, y, width, type) {
    const el = document.createElement('div');
    el.className = 'platform ' + type;
    el.style.width = width + 'px';
    game.appendChild(el);
    state.platforms.push({ el, x, y, w: width, h: 12, type, dir: Math.random() > 0.5 ? 1 : -1, broken: false });
}

let keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

const touchControls = {
    'btnLeft': 'ArrowLeft',
    'btnRight': 'ArrowRight',
    'btnJump': 'ArrowUp'
};

Object.keys(touchControls).forEach(id => {
    const btn = document.getElementById(id);
    const keyCode = touchControls[id];
    btn.ontouchstart = (e) => { e.preventDefault(); keys[keyCode] = true; };
    btn.ontouchend = (e) => { e.preventDefault(); keys[keyCode] = false; };
});

document.getElementById('startBtn').onclick = startGame;
document.getElementById('restartBtn').onclick = () => location.reload();

function startGame() {
    document.getElementById('startScreen').style.display = 'none';
    state.gameActive = true;
    initPlatforms();
    requestAnimationFrame(loop);
}

function loop() {
    if (!state.gameActive) return;

    if (keys['ArrowLeft']) state.vx -= config.moveSpeed;
    if (keys['ArrowRight']) state.vx += config.moveSpeed;
    state.vx *= config.friction;
    state.x += state.vx;

    state.vy += config.gravity;
    state.y += state.vy;
    state.y += state.scrollSpeed;
    state.scrollSpeed += config.difficultyScale;
    
    // تحديث نص السرعة
    let speedLabel = "هادية";
    if(state.scrollSpeed > 2) speedLabel = "وسط";
    if(state.scrollSpeed > 3) speedLabel = "شايطة!";
    speedVal.innerText = speedLabel;

    state.platforms.forEach(p => {
        p.y += state.scrollSpeed;
        if (p.type === 'moving') {
            p.x += p.dir * (1.5 + state.score/2000);
            if (p.x <= 0 || p.x + p.w >= game.clientWidth) p.dir *= -1;
        }

        if (!p.broken && state.vy >= 0 && 
            state.x + 55 > p.x && state.x + 15 < p.x + p.w && 
            state.y + 45 >= p.y && state.y + 45 <= p.y + 15) {
            
            state.y = p.y - 48;
            state.vy = 0;
            if (p.type === 'moving') state.x += p.dir * (1.5 + state.score/2000);

            if (keys['ArrowUp']) {
                state.vy = config.jumpForce;
                if (p.type === 'breakable') { p.broken = true; p.el.style.opacity = '0.3'; }
            }
        }
        p.el.style.left = p.x + 'px';
        p.el.style.top = p.y + 'px';
    });

    for (let i = state.platforms.length - 1; i >= 0; i--) {
        if (state.platforms[i].y > 600) {
            state.platforms[i].el.remove();
            state.platforms.splice(i, 1);
            spawnPlatform(-20);
            state.score += 5; // نقاط أقل لكل منصة لزيادة التحدي ببطء
            scoreVal.innerText = state.score;
        }
    }

    if (state.x < -10) state.x = -10;
    if (state.x > game.clientWidth - 60) state.x = game.clientWidth - 60;

    playerEl.style.left = state.x + 'px';
    playerEl.style.top = state.y + 'px';

    if (state.y > 600 || state.y < -200) {
        state.gameActive = false;
        document.getElementById('gameOverScreen').style.display = 'flex';
        document.getElementById('finalScore').innerText = state.score;
    } else {
        requestAnimationFrame(loop);
    }
}
</script>
</body>
</html>
