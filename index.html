<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>كشري الوزير</title>
<style>
    :root { --primary: #ff6b12; --danger: #ff4757; --accent: #f1c40f; }
    
    * { touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body { margin:0; overflow:hidden; background:#111; font-family: 'Arial', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
    
    #game { 
        position:relative; width:400px; height:600px; 
        background-image: url('اختراق.jpg'); background-size: contain; 
        background-repeat: no-repeat; background-position: center;
        background-color: #000;
        overflow:hidden; border:4px solid var(--primary); border-radius: 15px;
        max-width: 100vw; max-height: 100vh;
    }

    #ui { 
        position:absolute; top:0; left:0; width:100%; padding: 12px; box-sizing: border-box;
        display: flex; justify-content: space-between; background: rgba(0, 0, 0, 0.7); z-index: 50;
    }
    .stat-value { font-size: 18px; font-weight: bold; color: var(--accent); }

    .player { 
        position:absolute; width: 70px; height: 50px; 
        background-image: url('الطبق.png'); background-size: contain;
        background-repeat: no-repeat; background-position: center;
        z-index: 5;
        transition: transform 0.1s;
    }

    .platform { 
        position:absolute; width:100px; height:12px; 
        background: #eee; border-radius:10px; box-shadow: 0 4px 6px rgba(0,0,0,0.4); 
    }

    /* مناطق اللمس المخفية */
    #touch-left { position: absolute; left: 0; top: 0; width: 50%; height: 100%; z-index: 80; }
    #touch-right { position: absolute; right: 0; top: 0; width: 50%; height: 100%; z-index: 80; }

    .overlay { 
        position:absolute; inset:0; 
        display:flex; flex-direction:column; justify-content:center; align-items:center; 
        color:#fff; z-index: 200; text-align: center; padding: 20px;
    }
    
    #startScreen {
        background-image: url('U.jpg'); background-size: contain;
        background-repeat: no-repeat; background-position: center;
        background-color: #000;
    }
    #startScreen::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.5); }
    #startScreen * { z-index: 2; }

    #gameOverScreen { background: rgba(0,0,0,0.9); display: none; }

    .btn { 
        padding: 15px 40px; font-size: 24px; cursor: pointer; 
        background: var(--primary); border: none; color: white; 
        border-radius: 10px; font-weight: bold;
        box-shadow: 0 4px 0 #a3450b;
    }

    @media (max-width: 500px) {
        #game { width: 100vw; height: 100vh; border: none; border-radius: 0; }
    }
</style>
</head>
<body>

<div id="game">
    <div id="ui">
        <div>الطلب: <span id="scoreVal" class="stat-value">0</span></div>
        <div>النار: <span id="speedVal" class="stat-value">هادية</span></div>
    </div>

    <div id="player" class="player"></div>

    <div id="touch-left"></div>
    <div id="touch-right"></div>

    <div id="startScreen" class="overlay">
        <h1 style="color:var(--accent); font-size: 45px; margin-bottom:5px;">كشري الوزير</h1>
        <p style="margin-bottom:30px; font-size: 18px;">المس يمين أو شمال للتحرك<br>الطبق بينط لوحده!</p>
        <button id="startBtn" class="btn">افتح المحل</button>
    </div>

    <div id="gameOverScreen" class="overlay">
        <h1 style="color:var(--danger); font-size: 40px;">الصلصة شاطتت</h1>
        <p style="font-size: 22px;">الاسكور: <span id="finalScore" style="color:var(--accent)">0</span></p>
        <button id="restartBtn" class="btn">اغرف من جديد</button>
    </div>
</div>

<script>
const game = document.getElementById('game');
const playerEl = document.getElementById('player');
const scoreVal = document.getElementById('scoreVal');
const speedVal = document.getElementById('speedVal');

let config = {
    gravity: 0.4,
    jumpForce: -12,
    moveSpeed: 6, // سرعة الحركة الجانبية
    friction: 0.8,
    baseScrollSpeed: 1.0,
    difficultyScale: 0.0005
};

let state = {
    x: 160, y: 350,
    vx: 0, vy: 0,
    score: 0,
    gameActive: false,
    scrollSpeed: config.baseScrollSpeed,
    platforms: [],
    movingLeft: false,
    movingRight: false
};

function initPlatforms() {
    state.platforms = [];
    game.querySelectorAll('.platform').forEach(p => p.remove());
    // منصة البداية تكون كبيرة ومضمونة
    createPlatform(50, 500, 300, 'normal'); 
    for(let i = 1; i < 7; i++) {
        spawnPlatform(500 - (i * 110));
    }
}

function spawnPlatform(yPos) {
    let type = 'normal';
    if (state.score >= 300) {
        let rand = Math.random();
        if (rand > 0.8) type = 'moving';
    }
    createPlatform(Math.random() * (game.clientWidth - 100), yPos, 100, type);
}

function createPlatform(x, y, width, type) {
    const el = document.createElement('div');
    el.className = 'platform ' + type;
    el.style.width = width + 'px';
    game.appendChild(el);
    state.platforms.push({ el, x, y, w: width, h: 12, type, dir: Math.random() > 0.5 ? 1 : -1 });
}

// التحكم باللمس
document.getElementById('touch-left').ontouchstart = (e) => { e.preventDefault(); state.movingLeft = true; };
document.getElementById('touch-left').ontouchend = () => state.movingLeft = false;

document.getElementById('touch-right').ontouchstart = (e) => { e.preventDefault(); state.movingRight = true; };
document.getElementById('touch-right').ontouchend = () => state.movingRight = false;

// دعم لوحة المفاتيح أيضاً
window.onkeydown = e => {
    if(e.code === 'ArrowLeft') state.movingLeft = true;
    if(e.code === 'ArrowRight') state.movingRight = true;
};
window.onkeyup = e => {
    if(e.code === 'ArrowLeft') state.movingLeft = false;
    if(e.code === 'ArrowRight') state.movingRight = false;
};

document.getElementById('startBtn').onclick = startGame;
document.getElementById('restartBtn').onclick = () => location.reload();

function startGame() {
    document.getElementById('startScreen').style.display = 'none';
    state.gameActive = true;
    initPlatforms();
    requestAnimationFrame(loop);
}

function loop() {
    if (!state.gameActive) return;

    // حركة جانبية
    if (state.movingLeft) state.vx = -config.moveSpeed;
    else if (state.movingRight) state.vx = config.moveSpeed;
    else state.vx *= config.friction;
    
    state.x += state.vx;

    // فيزياء القفز والجاذبية
    state.vy += config.gravity;
    state.y += state.vy;
    
    // حركة الكاميرا (الشاشة بتنزل لتحت)
    state.y += state.scrollSpeed;
    state.scrollSpeed += config.difficultyScale;

    // تحديث مظهر اللاعب (ميلان حسب الحركة)
    playerEl.style.transform = `rotate(${state.vx * 2}deg)`;

    state.platforms.forEach(p => {
        p.y += state.scrollSpeed;
        
        if (p.type === 'moving') {
            p.x += p.dir * 2;
            if (p.x <= 0 || p.x + p.w >= game.clientWidth) p.dir *= -1;
        }

        // التصادم والقفز التلقائي
        if (state.vy > 0 && 
            state.x + 50 > p.x && state.x + 10 < p.x + p.w && 
            state.y + 45 >= p.y && state.y + 45 <= p.y + 20) {
            
            state.vy = config.jumpForce; // ينط لوحده
            state.y = p.y - 46;
        }
        
        p.el.style.left = p.x + 'px';
        p.el.style.top = p.y + 'px';
    });

    // توليد منصات جديدة
    for (let i = state.platforms.length - 1; i >= 0; i--) {
        if (state.platforms[i].y > 620) {
            state.platforms[i].el.remove();
            state.platforms.splice(i, 1);
            spawnPlatform(-20);
            state.score += 10;
            scoreVal.innerText = state.score;
        }
    }

    // حدود الشاشة
    if (state.x < -20) state.x = game.clientWidth - 40; // يخرج من الشمال يظهر من اليمين
    else if (state.x > game.clientWidth - 40) state.x = -20;

    playerEl.style.left = state.x + 'px';
    playerEl.style.top = state.y + 'px';

    // خسارة
    if (state.y > 600 || state.y < -300) {
        state.gameActive = false;
        document.getElementById('gameOverScreen').style.display = 'flex';
        document.getElementById('finalScore').innerText = state.score;
    } else {
        requestAnimationFrame(loop);
    }
}
</script>
</body>
</html>
